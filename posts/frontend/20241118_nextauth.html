<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/354532eb11cf5fad.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/fd630683d467c7dc.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/9b708f2b186acac9.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-8e3b6a1075085843.js"/><script src="/_next/static/chunks/fd9d1056-276cbb616832792e.js" async=""></script><script src="/_next/static/chunks/117-1eba4c6b928b547f.js" async=""></script><script src="/_next/static/chunks/main-app-98a54b5e9a56ce4c.js" async=""></script><script src="/_next/static/chunks/972-1dbf1ef7026efe61.js" async=""></script><script src="/_next/static/chunks/app/layout-fc049b8ba3ff4c4c.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bcategory%5D/%5Bslug%5D/page-666dcf2419a8ec86.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtm.js?id=GTM-TPP4K84Z" as="script"/><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-KJHY5R4DCG" as="script"/><title>NextAuth - UntrustedHost 이해하기</title><meta name="description" content="NextAuth.js v5에서 마주치는 UntrustedHost 오류의 원인과 해결 방법을 알아봅니다. trustHost 옵션 설정부터 X-Forwarded-Host 헤더의 역할, 그리고 로컬 환경과 프로덕션 환경에서의 올바른 설정 방법까지 자세히 다룹니다."/><link rel="stylesheet" as="style" crossorigin="anonymous" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><header class="Header_header__hO3lJ"><div class="Header_header__container__G6Vkc"><nav><ul class="Header_header__list__sxYO7"><li><a class="Header_header__link___Ksrt " href="/">about</a></li><li><a class="Header_header__link___Ksrt Header_header__link--active__IIndw" href="/posts">posts</a></li></ul></nav></div></header><main><article><header class="PostDetail_post-detail__header__zshZb"><h1>NextAuth - UntrustedHost 이해하기</h1><time class="PostDetail_post-detail__date__9juxR" dateTime="2024-11-18">18 Nov 2024</time></header><div class="markdown"><h2 id="문제-상황">문제 상황</h2>
<p><strong>NextAuth.js v5</strong>를 사용하여 인증을 구현하던 중,<br/>
<!-- -->로컬 환경에서 프로덕션 모드로 실행시 다음과 같은 오류 메시지가 발생했습니다.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="bash" data-theme="github-dark-dimmed github-light"><code data-language="bash" data-theme="github-dark-dimmed github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> [tk: Host must be trusted. URL was: http://localhost:3000/api/auth/session. Read more at https://errors.authjs.dev#untrustedhost] {</span></span>
<span data-line=""><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1">  name:</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;tk&#x27;,</span></span>
<span data-line=""><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">  type</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">:</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;UntrustedHost&#x27;,</span></span>
<span data-line=""><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1">  kind:</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;error&#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">} []</span></span></code></pre></figure>
<h2 id="해결-방법">해결 방법</h2>
<h3 id="trusthost-옵션-설정하기">TrustHost 옵션 설정하기</h3>
<p>이 오류는 다음 두 가지 방법 중 하나로 해결할 수 있습니다.</p>
<p>🔗 <a href="https://authjs.dev/reference/core/errors#untrustedhost">Auth.js - UntrustedHost</a></p>
<ol>
<li>
<p>NextAuth 설정에서 직접 설정</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> authConfig</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  ...</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  trustHost: </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">true</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  ...</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">}</span></span></code></pre></figure>
</li>
<li>
<p>환경 변수로 설정</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">AUTH_TRUST_HOST</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">TRUE</span></span></code></pre></figure>
</li>
</ol>
<p>이제 이 오류가 발생하는 원인에 대해 좀 더 깊이 살펴보겠습니다.</p>
<h2 id="기술적-배경">기술적 배경</h2>
<h3 id="auth_trust_host란"><strong>AUTH_TRUST_HOST</strong>란?</h3>
<p>공식 문서에 따르면, <strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>AUTH_TRUST_HOST</span></span></code></span></strong> 환경 변수는 다음과 같이 설명되어 있습니다.</p>
<blockquote>
<p>When deploying your application behind a reverse proxy, you’ll need to set <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>AUTH_TRUST_HOST</span></span></code></span> equal to true. This tells Auth.js to trust the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>X-Forwarded-Host</span></span></code></span> header from the reverse proxy. Auth.js will automatically infer this to be true if we detect the environment variable indicating that your application is running on one of the supported hosting providers. Currently VERCEL and CF_PAGES (Cloudflare Pages) are supported.</p>
</blockquote>
<p>AUTH_TRUST_HOST 설정은 리버스 프록시 환경에서 특히 중요합니다.<br/>
<!-- -->이 설정이 필요한 주요 상황은 다음과 같습니다.</p>
<ul>
<li>
<p>리버스 프록시 사용 시</p>
</li>
<li>
<p><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>X-Forwarded-Host</span></span></code></span> 헤더를 사용하는 환경</p>
</li>
<li>
<p>특정 호스팅 제공업체 사용 시</p>
</li>
</ul>
<h3 id="자동-활성화-환경">자동 활성화 환경</h3>
<p>다음 호스팅 환경에서는 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>AUTH_TRUST_HOST</span></span></code></span>가 자동으로 활성화됩니다.</p>
<ul>
<li>Vercel</li>
<li>Cloudflare Pages</li>
</ul>
<h3 id="x-forwarded-host-헤더의-역할"><strong>X-Forwarded-Host 헤더의 역할</strong></h3>
<ul>
<li>클라이언트의 원래 요청 호스트 정보를 포함</li>
<li>리버스 프록시 환경에서 중요한 역할</li>
<li>로드 밸런서나 프록시 서버에서 주로 사용</li>
</ul>
<h2 id="로컬-환경에서의-untrustedhost-오류">로컬 환경에서의 <strong>UntrustedHost</strong> 오류</h2>
<h3 id="발생-원인">발생 원인</h3>
<p>로컬 환경에서 프로덕션 모드 실행 시 <strong>UntrustedHost 오류가 발생하는 이유</strong></p>
<ol>
<li>Next.js의 내부 동작<!-- -->
<ol>
<li>리버스 프록시가 없어도 <strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>X-Forwarded-Host</span></span></code></span></strong> 헤더 자동 설정</li>
</ol>
</li>
<li>NextAuth의 보안 정책<!-- -->
<ol>
<li>프로덕션 환경에서 호스트 검증 수행</li>
<li>명시적인 신뢰 설정 요구</li>
</ol>
</li>
</ol>
<h3 id="nextauth의-내부-동작">NextAuth의 내부 동작</h3>
<p>NextAuth v5의 코드를 살펴보면 다음과 같은 로직으로 작동합니다.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// node_modules/@auth/core/src/lib/utils/env.ts</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  config.trustHost </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">??=</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> !!</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    envObject.</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">AUTH_URL</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> ??</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    envObject.</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">AUTH_TRUST_HOST</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> ??</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    envObject.</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">VERCEL</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> ??</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    envObject.</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">CF_PAGES</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> ??</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    envObject.</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">NODE_ENV</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> !==</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &quot;production&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  )</span></span></code></pre></figure>
<p>이 코드는 다음 조건들을 확인하여 trustHost 값을 결정합니다.</p>
<ul>
<li>AUTH_URL 존재 여부</li>
<li>AUTH_TRUST_HOST 설정</li>
<li>Vercel 환경</li>
<li>Cloudflare Pages 환경</li>
<li>개발 환경 여부</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// node_modules/@auth/core/src/lib/utils/assert.ts</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> function</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> assertConfig</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">request</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">options</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    const</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">url</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> request;</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> warnings</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> [];</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">!</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">warned </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">&amp;&amp;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> options.debug)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">        warnings.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">push</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;debug-enabled&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">);</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">!</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">options.trustHost) {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">        return</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> UntrustedHost</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">`Host must be trusted. URL was: ${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">request</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">.</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">url</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">);</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    }</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    </span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    ...</span></span></code></pre></figure>
<p><strong>X-Forwarded-Host</strong> 헤더를 사용하는 코드</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// node_modules/@auth/core/src/lib/utils/env.ts </span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> function</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> createActionURL</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span></span>
<span data-line=""><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">  action</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1"> AuthAction</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">  protocol</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> string</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">  headers</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1"> Headers</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">  envObject</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> any</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">  config</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1"> Pick</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">&lt;</span><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1">AuthConfig</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;basePath&quot;</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> |</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &quot;logger&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">&gt;</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1"> URL</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> basePath</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> config?.basePath</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> envUrl</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> envObject.</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">AUTH_URL</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> ??</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> envObject.</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">NEXTAUTH_URL</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  let</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> url</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1"> URL</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (envUrl) {</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    url </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> URL</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(envUrl)</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (basePath </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">&amp;&amp;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> basePath </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">!==</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &quot;/&quot;</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> &amp;&amp;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> url.pathname </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">!==</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &quot;/&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">      if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (url.pathname </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">!==</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> basePath) {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">        const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> logger</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> setLogger</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(config)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">        logger.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">warn</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;env-url-basepath-mismatch&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      }</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      url.pathname </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &quot;/&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    }</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">else</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> detectedHost</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> headers.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">get</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;x-forwarded-host&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">??</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> headers.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">get</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;host&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> detectedProtocol</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      headers.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">get</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;x-forwarded-proto&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">??</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> protocol </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">??</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &quot;https&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> _protocol</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> detectedProtocol.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">endsWith</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;:&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">      ?</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> detectedProtocol</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">      :</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> detectedProtocol </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">+</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &quot;:&quot;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    url </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> URL</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">`${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">_protocol</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}//${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">detectedHost</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">  // remove trailing slash</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> sanitizedUrl</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> url.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">toString</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">().</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">replace</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">/</span><span style="--shiki-dark:#8DDB8C;--shiki-dark-font-weight:bold;--shiki-light:#22863A;--shiki-light-font-weight:bold">\/</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">$</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">/</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (basePath) {</span></span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">    // remove leading and trailing slash</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> sanitizedBasePath</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> basePath?.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">replace</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">/(</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">^</span><span style="--shiki-dark:#8DDB8C;--shiki-dark-font-weight:bold;--shiki-light:#22863A;--shiki-light-font-weight:bold">\/</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">|</span><span style="--shiki-dark:#8DDB8C;--shiki-dark-font-weight:bold;--shiki-light:#22863A;--shiki-light-font-weight:bold">\/</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">$</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">)/</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">g</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&quot;&quot;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">??</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &quot;&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    return</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> URL</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">`${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">sanitizedUrl</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}/${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">sanitizedBasePath</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}/${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">action</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  }</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  return</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> URL</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">`${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">sanitizedUrl</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}/${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">action</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">}</span></span>
<span data-line=""> </span></code></pre></figure>
<p>음..?</p>
<p>이 코드는 <strong><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>X-Forwarded-Host</span></span></code></span></strong> 헤더를 사용하여 URL을 생성하는 용도로만 사용됩니다.</p>
<p>작성된 공식 문서를 보았을 때, 아마 v5 이전 버전에는 x-forwarded-host 와 실제 host를 비교하는 보안 검증이 있었던 것 같습니다.</p>
<h2 id="실제-적용-가이드">실제 적용 가이드</h2>
<h3 id="로컬-개발-환경">로컬 개발 환경</h3>
<p>개발 환경에서는 별도 설정이 필요 없습니다. (<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>NODE_ENV !== &quot;production&quot;</span></span></code></span> 조건으로 인해)</p>
<h3 id="로컬-프로덕션-테스트">로컬 프로덕션 테스트</h3>
<p>다음 중 한 가지 방법으로 설정하세요.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// .env</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"># 환경 변수 설정</span></span>
<span data-line=""><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">AUTH_TRUST_HOST</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">TRUE</span></span></code></pre></figure>
<p>또는</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// NextAuth 설정</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> authConfig</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> {</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  trustHost: </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">true</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">}</span></span></code></pre></figure>
<h3 id="실제-프로덕션-환경">실제 프로덕션 환경</h3>
<ul>
<li>Vercel/Cloudflare Pages<!-- -->
<ul>
<li>추가 설정 불필요 (자동 활성화)</li>
</ul>
</li>
<li>기타 호스팅 환경<!-- -->
<ul>
<li>환경에 맞는 적절한 trustHost 설정 필요</li>
<li>리버스 프록시 사용 시 반드시 활성화</li>
</ul>
</li>
</ul>
<h2 id="결론">결론</h2>
<p>NextAuth v5에서의 UntrustedHost 메시지는 보안을 위한 호스트 검증 절차의 일부입니다.</p>
<p>이는 이전 버전과 달리(추측) <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>X-Forwarded-Host</span></span></code></span> 헤더 검증과는 직접적인 관련이 없으며, 환경 변수나 설정을 통해 제어됩니다.</p>
<p>특히 로컬에서 프로덕션 모드 테스트 시에는 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed github-light"><span data-line=""><span>AUTH_TRUST_HOST=true</span></span></code></span> 설정으로 해결할 수 있으며, 실제 배포 환경에서는 해당 환경에 맞는 적절한 설정을 사용하면 됩니다.</p></div><hr class="Divider_divider__iotiM"/><div></div></article></main><script src="/_next/static/chunks/webpack-8e3b6a1075085843.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/354532eb11cf5fad.css\",\"style\"]\n2:HL[\"/_next/static/css/fd630683d467c7dc.css\",\"style\"]\n3:HL[\"/_next/static/css/9b708f2b186acac9.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"4:I[2846,[],\"\"]\n7:I[4707,[],\"\"]\na:I[6423,[],\"\"]\nb:I[8087,[\"972\",\"static/chunks/972-1dbf1ef7026efe61.js\",\"185\",\"static/chunks/app/layout-fc049b8ba3ff4c4c.js\"],\"GoogleTagManager\"]\nc:I[7955,[\"972\",\"static/chunks/972-1dbf1ef7026efe61.js\",\"185\",\"static/chunks/app/layout-fc049b8ba3ff4c4c.js\"],\"default\"]\nd:I[4888,[\"972\",\"static/chunks/972-1dbf1ef7026efe61.js\",\"185\",\"static/chunks/app/layout-fc049b8ba3ff4c4c.js\"],\"GoogleAnalytics\"]\nf:I[1060,[],\"\"]\n8:[\"category\",\"frontend\",\"d\"]\n9:[\"slug\",\"20241118_nextauth\",\"d\"]\n10:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L4\",null,{\"buildId\":\"fL74k-rNd5x-lLvSHMVMH\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"posts\",\"frontend\",\"20241118_nextauth\"],\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"category\",\"frontend\",\"d\"],{\"children\":[[\"slug\",\"20241118_nextauth\",\"d\"],{\"children\":[\"__PAGE__?{\\\"category\\\":\\\"frontend\\\",\\\"slug\\\":\\\"20241118_nextauth\\\"}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"category\",\"frontend\",\"d\"],{\"children\":[[\"slug\",\"20241118_nextauth\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L5\",\"$L6\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/fd630683d467c7dc.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9b708f2b186acac9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$8\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$8\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/354532eb11cf5fad.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"as\":\"style\",\"crossOrigin\":\"anonymous\",\"href\":\"https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css\"}],[\"$\",\"$Lb\",null,{\"gtmId\":\"GTM-TPP4K84Z\"}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}],[\"$\",\"$Ld\",null,{\"gaId\":\"G-KJHY5R4DCG\"}]]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]\n"])</script><script>self.__next_f.push([1,"11:I[3706,[\"210\",\"static/chunks/app/posts/%5Bcategory%5D/%5Bslug%5D/page-666dcf2419a8ec86.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"6:[\"$\",\"main\",null,{\"children\":[\"$\",\"article\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"PostDetail_post-detail__header__zshZb\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"NextAuth - UntrustedHost 이해하기\"}],[\"$\",\"time\",null,{\"className\":\"PostDetail_post-detail__date__9juxR\",\"dateTime\":\"2024-11-18\",\"children\":\"18 Nov 2024\"}]]}],[\"$\",\"div\",null,{\"className\":\"markdown\",\"children\":[[\"$\",\"h2\",null,{\"id\":\"문제-상황\",\"children\":\"문제 상황\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"NextAuth.js v5\"}],\"를 사용하여 인증을 구현하던 중,\",[\"$\",\"br\",null,{}],\"\\n\",\"로컬 환경에서 프로덕션 모드로 실행시 다음과 같은 오류 메시지가 발생했습니다.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" [tk: Host must be trusted. URL was: http://localhost:3000/api/auth/session. Read more at https://errors.authjs.dev#untrustedhost] {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"  name:\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'tk',\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"  type\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'UntrustedHost',\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"  kind:\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'error'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"} []\"}]}]]}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"해결-방법\",\"children\":\"해결 방법\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"trusthost-옵션-설정하기\",\"children\":\"TrustHost 옵션 설정하기\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이 오류는 다음 두 가지 방법 중 하나로 해결할 수 있습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"🔗 \",[\"$\",\"a\",null,{\"href\":\"https://authjs.dev/reference/core/errors#untrustedhost\",\"children\":\"Auth.js - UntrustedHost\"}]]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"NextAuth 설정에서 직접 설정\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" authConfig\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  trustHost: \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"true\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  ...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"환경 변수로 설정\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"AUTH_TRUST_HOST\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"TRUE\"}]]}]}]}]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이제 이 오류가 발생하는 원인에 대해 좀 더 깊이 살펴보겠습니다.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"기술적-배경\",\"children\":\"기술적 배경\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"auth_trust_host란\",\"children\":[[\"$\",\"strong\",null,{\"children\":\"AUTH_TRUST_HOST\"}],\"란?\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"공식 문서에 따르면, \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AUTH_TRUST_HOST\"}]}]}]}]}],\" 환경 변수는 다음과 같이 설명되어 있습니다.\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When deploying your application behind a reverse proxy, you’ll need to set \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AUTH_TRUST_HOST\"}]}]}]}],\" equal to true. This tells Auth.js to trust the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"X-Forwarded-Host\"}]}]}]}],\" header from the reverse proxy. Auth.js will automatically infer this to be true if we detect the environment variable indicating that your application is running on one of the supported hosting providers. Currently VERCEL and CF_PAGES (Cloudflare Pages) are supported.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"AUTH_TRUST_HOST 설정은 리버스 프록시 환경에서 특히 중요합니다.\",[\"$\",\"br\",null,{}],\"\\n\",\"이 설정이 필요한 주요 상황은 다음과 같습니다.\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"리버스 프록시 사용 시\"}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"X-Forwarded-Host\"}]}]}]}],\" 헤더를 사용하는 환경\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"특정 호스팅 제공업체 사용 시\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"자동-활성화-환경\",\"children\":\"자동 활성화 환경\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"다음 호스팅 환경에서는 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AUTH_TRUST_HOST\"}]}]}]}],\"가 자동으로 활성화됩니다.\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Vercel\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Cloudflare Pages\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"x-forwarded-host-헤더의-역할\",\"children\":[\"$\",\"strong\",null,{\"children\":\"X-Forwarded-Host 헤더의 역할\"}]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"클라이언트의 원래 요청 호스트 정보를 포함\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"리버스 프록시 환경에서 중요한 역할\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"로드 밸런서나 프록시 서버에서 주로 사용\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"로컬-환경에서의-untrustedhost-오류\",\"children\":[\"로컬 환경에서의 \",[\"$\",\"strong\",null,{\"children\":\"UntrustedHost\"}],\" 오류\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"발생-원인\",\"children\":\"발생 원인\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"로컬 환경에서 프로덕션 모드 실행 시 \",[\"$\",\"strong\",null,{\"children\":\"UntrustedHost 오류가 발생하는 이유\"}]]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Next.js의 내부 동작\",\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"리버스 프록시가 없어도 \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"X-Forwarded-Host\"}]}]}]}]}],\" 헤더 자동 설정\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"NextAuth의 보안 정책\",\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"프로덕션 환경에서 호스트 검증 수행\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"명시적인 신뢰 설정 요구\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"nextauth의-내부-동작\",\"children\":\"NextAuth의 내부 동작\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"NextAuth v5의 코드를 살펴보면 다음과 같은 로직으로 작동합니다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// node_modules/@auth/core/src/lib/utils/env.ts\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  config.trustHost \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"??=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" !!\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    envObject.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"AUTH_URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" ??\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    envObject.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"AUTH_TRUST_HOST\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" ??\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    envObject.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"VERCEL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" ??\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    envObject.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"CF_PAGES\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" ??\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    envObject.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"NODE_ENV\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" !==\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"production\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  )\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"이 코드는 다음 조건들을 확인하여 trustHost 값을 결정합니다.\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"AUTH_URL 존재 여부\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"AUTH_TRUST_HOST 설정\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Vercel 환경\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Cloudflare Pages 환경\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"개발 환경 여부\"}],\"\\n\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// node_modules/@auth/core/src/lib/utils/assert.ts\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" assertConfig\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"request\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"options\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" request;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" warnings\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" [];\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"warned \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"\u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" options.debug)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"        warnings.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"push\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"debug-enabled\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"options.trustHost) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"        return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" UntrustedHost\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"`Host must be trusted. URL was: ${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"request\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    ...\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"X-Forwarded-Host\"}],\" 헤더를 사용하는 코드\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// node_modules/@auth/core/src/lib/utils/env.ts \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" createActionURL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"  action\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" AuthAction\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"  protocol\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"  headers\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" Headers\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"  envObject\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" any\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"  config\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" Pick\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"AuthConfig\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"basePath\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" |\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"logger\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"\u003e\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" basePath\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" config?.basePath\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" envUrl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" envObject.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"AUTH_URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" ??\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" envObject.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"NEXTAUTH_URL\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  let\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" url\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (envUrl) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    url \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(envUrl)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (basePath \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"\u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" basePath \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"!==\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"/\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" \u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" url.pathname \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"!==\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"/\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"      if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (url.pathname \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"!==\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" basePath) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"        const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" logger\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" setLogger\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(config)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"        logger.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"warn\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"env-url-basepath-mismatch\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      url.pathname \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"/\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" detectedHost\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" headers.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"x-forwarded-host\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"??\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" headers.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"host\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" detectedProtocol\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      headers.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"x-forwarded-proto\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"??\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" protocol \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"??\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"https\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" _protocol\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" detectedProtocol.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"endsWith\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\":\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"      ?\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" detectedProtocol\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"      :\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" detectedProtocol \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\":\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    url \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"`${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"_protocol\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}//${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"detectedHost\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"  // remove trailing slash\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" sanitizedUrl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" url.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"toString\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"replace\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"/\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#8DDB8C\",\"--shiki-dark-font-weight\":\"bold\",\"--shiki-light\":\"#22863A\",\"--shiki-light-font-weight\":\"bold\"},\"children\":\"\\\\/\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"/\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (basePath) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"    // remove leading and trailing slash\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" sanitizedBasePath\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" basePath?.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"replace\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"/(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"^\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#8DDB8C\",\"--shiki-dark-font-weight\":\"bold\",\"--shiki-light\":\"#22863A\",\"--shiki-light-font-weight\":\"bold\"},\"children\":\"\\\\/\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"|\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#8DDB8C\",\"--shiki-dark-font-weight\":\"bold\",\"--shiki-light\":\"#22863A\",\"--shiki-light-font-weight\":\"bold\"},\"children\":\"\\\\/\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"$$\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\")/\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"g\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"??\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"`${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"sanitizedUrl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}/${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"sanitizedBasePath\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}/${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"action\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"`${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"sanitizedUrl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}/${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"action\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"음..?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이 코드는 \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"X-Forwarded-Host\"}]}]}]}]}],\" 헤더를 사용하여 URL을 생성하는 용도로만 사용됩니다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"작성된 공식 문서를 보았을 때, 아마 v5 이전 버전에는 x-forwarded-host 와 실제 host를 비교하는 보안 검증이 있었던 것 같습니다.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"실제-적용-가이드\",\"children\":\"실제 적용 가이드\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"로컬-개발-환경\",\"children\":\"로컬 개발 환경\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"개발 환경에서는 별도 설정이 필요 없습니다. (\",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"NODE_ENV !== \\\"production\\\"\"}]}]}]}],\" 조건으로 인해)\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"로컬-프로덕션-테스트\",\"children\":\"로컬 프로덕션 테스트\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"다음 중 한 가지 방법으로 설정하세요.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// .env\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"# 환경 변수 설정\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"AUTH_TRUST_HOST\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"TRUE\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"또는\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// NextAuth 설정\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" authConfig\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  trustHost: \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"true\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"실제-프로덕션-환경\",\"children\":\"실제 프로덕션 환경\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Vercel/Cloudflare Pages\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"추가 설정 불필요 (자동 활성화)\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"기타 호스팅 환경\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"환경에 맞는 적절한 trustHost 설정 필요\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"리버스 프록시 사용 시 반드시 활성화\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"결론\",\"children\":\"결론\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"NextAuth v5에서의 UntrustedHost 메시지는 보안을 위한 호스트 검증 절차의 일부입니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"이는 이전 버전과 달리(추측) \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"X-Forwarded-Host\"}]}]}]}],\" 헤더 검증과는 직접적인 관련이 없으며, 환경 변수나 설정을 통해 제어됩니다.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"특히 로컬에서 프로덕션 모드 테스트 시에는 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AUTH_TRUST_HOST=true\"}]}]}]}],\" 설정으로 해결할 수 있으며, 실제 배포 환경에서는 해당 환경에 맞는 적절한 설정을 사용하면 됩니다.\"]}]]}],[\"$\",\"hr\",null,{\"className\":\"Divider_divider__iotiM\"}],[\"$\",\"$L11\",null,{}]]}]}]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"NextAuth - UntrustedHost 이해하기\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"NextAuth.js v5에서 마주치는 UntrustedHost 오류의 원인과 해결 방법을 알아봅니다. trustHost 옵션 설정부터 X-Forwarded-Host 헤더의 역할, 그리고 로컬 환경과 프로덕션 환경에서의 올바른 설정 방법까지 자세히 다룹니다.\"}]]\n5:null\n"])</script></body></html>