<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/posts/20241113_nextauth.png"/><link rel="stylesheet" href="/_next/static/css/354532eb11cf5fad.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/fd630683d467c7dc.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/9b708f2b186acac9.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-8e3b6a1075085843.js"/><script src="/_next/static/chunks/fd9d1056-276cbb616832792e.js" async=""></script><script src="/_next/static/chunks/117-1eba4c6b928b547f.js" async=""></script><script src="/_next/static/chunks/main-app-98a54b5e9a56ce4c.js" async=""></script><script src="/_next/static/chunks/972-1dbf1ef7026efe61.js" async=""></script><script src="/_next/static/chunks/app/layout-fc049b8ba3ff4c4c.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bcategory%5D/%5Bslug%5D/page-666dcf2419a8ec86.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtm.js?id=GTM-TPP4K84Z" as="script"/><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-KJHY5R4DCG" as="script"/><title>Next.js 15 Edge Runtime에서 NextAuth v5와 bcrypt 호환성 문제 해결하기</title><meta name="description" content="Next.js 14에서 NextAuth v5를 사용하면서 마주친 Edge Runtime과 bcrypt 호환성 이슈를 해결하는 과정을 다룹니다. Node.js 네이티브 모듈의 Edge Runtime 제약사항과 이를 해결하기 위한 설정 분리 방법을 상세히 설명합니다."/><link rel="stylesheet" as="style" crossorigin="anonymous" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><header class="Header_header__hO3lJ"><div class="Header_header__container__G6Vkc"><nav><ul class="Header_header__list__sxYO7"><li><a class="Header_header__link___Ksrt " href="/">about</a></li><li><a class="Header_header__link___Ksrt Header_header__link--active__IIndw" href="/posts">posts</a></li></ul></nav></div></header><main><article><header class="PostDetail_post-detail__header__zshZb"><h1>Next.js 15 Edge Runtime에서 NextAuth v5와 bcrypt 호환성 문제 해결하기</h1><time class="PostDetail_post-detail__date__9juxR" dateTime="2024-11-13">13 Nov 2024</time></header><div class="markdown"><h2 id="들어가며">들어가며</h2>
<p>현재 개발 중인 프로젝트에서 NextAuth.js v5를 사용하여 인증을 구현하고 있습니다.<br/>
<!-- -->액세스 토큰과 리프레시 토큰을 활용한 인증 시스템에서 비밀번호 해시화를 위해 bcrypt를 사용하던 중 예상치 못한 문제가 발생했습니다.</p>
<h2 id="문제-상황">문제 상황</h2>
<p>미들웨어를 통해 리프레시 토큰 만료 시 자동 로그아웃 처리를 구현하던 중, 다음과 같은 에러가 발생했습니다.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-line-numbers="" data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid" data-line-numbers-max-digits="2"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// src/lib/auth.ts</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">import</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> NextAuth </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">from</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;next-auth&#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">import</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> Credentials </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">from</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;next-auth/providers/credentials&#x27;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> const</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">handlers</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">signIn</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">signOut</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">auth</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> NextAuth</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">({</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  providers: [</span></span>
<span data-line=""><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">    Credentials</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">({</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      credentials: {</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">        email: {},</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">        password: {},</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      },</span></span>
<span data-line=""><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">      authorize</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">: </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">async</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">credentials</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=&gt;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> {</span></span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">        // 사용자 정보를 DB로부터 가져오는 함수</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">        const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> user</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> await</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> getUserFromDb</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(credentials.email, password)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">        if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">!</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">user) {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">          throw</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> Error</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&#x27;Invalid credentials.&#x27;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">        }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">        return</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> user</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      },</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    }),</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  ],</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">})</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-line-numbers="" data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid" data-line-numbers-max-digits="2"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// src/middleware.ts</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">import</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { NextResponse } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">from</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;next/server&#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">import</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> type</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { NextRequest } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">from</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;next/server&#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">import</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { auth, signOut } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">from</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;@/lib/auth&#x27;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> async</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> function</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> middleware</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">request</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1"> NextRequest</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> session</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> await</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> auth</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">()</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (session?.error </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">===</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;RefreshToken expired&#x27;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) {</span></span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">    // 로그아웃 처리</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    await</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> signOut</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">    // 현재 URL을 state로 저장하여 로그인 후 리다이렉트할 수 있도록 함</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> callbackUrl</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> encodeURIComponent</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(request.url)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">    // 로그인 페이지로 리다이렉트</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    return</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> NextResponse.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">redirect</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">      new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> URL</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">`/signin?callbackUrl=${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">callbackUrl</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, request.url)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    )</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  return</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> NextResponse.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">next</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">()</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">}</span></span></code></pre></figure>
<p><img src="/posts/20241113_nextauth.png" alt="Edge Runtime 에러 화면"/></p>
<h2 id="원인-분석">원인 분석</h2>
<h3 id="edge-runtime의-제약사항">Edge Runtime의 제약사항</h3>
<p>Next.js의 미들웨어는 Edge Runtime 환경에서 실행되도록 설계되었습니다. Edge Runtime은 더 빠른 응답 시간과 글로벌 배포를 위해 최적화된 환경이지만, Node.js의 네이티브 모듈을 지원하지 않는 제약이 있습니다.</p>
<p>🔗 <a href="https://nextjs.org/docs/app/building-your-application/routing/middleware#runtime" target="_blank" rel="noopener noreferrer">Next.js middleware - Runtime</a></p>
<h3 id="bcrypt의-특성">bcrypt의 특성</h3>
<p>bcrypt는 C++로 작성된 네이티브 모듈입니다. node-pre-gyp 패키지를 통해 Node.js 환경에서 실행되는 네이티브 C++ 확장 모듈을 사전 빌드하여 배포하는데, 이는 Edge Runtime에서 실행될 수 없습니다.</p>
<h2 id="해결방안">해결방안</h2>
<ol>
<li>
<p>bcryptjs로 교체
bcryptjs는 순수 JavaScript로 작성되어 있어 클라이언트 사이드에서도 실행이 가능합니다. 하지만 bcrypt에 비해 약 30% 정도 성능이 떨어진다는 단점이 있습니다.</p>
<p>🔗 <a href="https://github.com/dcodeIO/bcrypt.js?tab=readme-ov-file#security-considerations" target="_blank" rel="noopener noreferrer">bcrypt.js github - Security considerations</a></p>
</li>
<li>
<p>설정 분리 (선택한 방안)
bcrypt를 포함하는 설정을 별도로 분리하여 Edge Runtime에서 실행되지 않도록 처리하는 방법을 선택했습니다.</p>
</li>
</ol>
<br/>
<p>다음은 구체적인 구현 방법입니다.</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-line-numbers="" data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid" data-line-numbers-max-digits="1"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// src/lib/auth.config.ts</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// bcrpyt를 제외한 config를 분리한다.</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> authConfig</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> {</span></span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">  //...</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  providers: [],</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">}</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-line-numbers="" data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid" data-line-numbers-max-digits="2"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// src/lib/auth.ts</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// bcrpyt를 제외한 config를 import한다.</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">import</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { authConfig } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">from</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;@/lib/auth/auth.config&#x27;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> const</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">handlers</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">signIn</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">signOut</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">auth</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> NextAuth</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">({</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  ...</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">authConfig, </span><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// 추가</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  providers: [</span></span>
<span data-line=""><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">    Credentials</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">({</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      credentials: {</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">        email: {},</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">        password: {},</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      },</span></span>
<span data-line=""><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">      authorize</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">: </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">async</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">credentials</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=&gt;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> {</span></span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">        // 사용자 정보를 DB로부터 가져오는 로직</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">        const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> user</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> await</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> getUserFromDb</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(credentials.email, password)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">        if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">!</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">user) {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">          throw</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> Error</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">&#x27;Invalid credentials.&#x27;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">        }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">        return</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> user</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">      },</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    }),</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  ],</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">})</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="tsx" data-theme="github-dark-dimmed github-light"><code data-line-numbers="" data-language="tsx" data-theme="github-dark-dimmed github-light" style="display:grid" data-line-numbers-max-digits="2"><span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// middleware.ts</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">import</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> NextAuth </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">from</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;next-auth&#x27;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// bcrpyt를 제외한 config를 import한다.</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">import</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { authConfig } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">from</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;@/lib/auth/auth.config&#x27;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">const</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5">auth</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> } </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> NextAuth</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">({ authConfig }) </span><span style="--shiki-dark:#768390;--shiki-light:#6A737D">// NextAuth에 쇽!</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> async</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> function</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> middleware</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#F69D50;--shiki-light:#E36209">request</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#F69D50;--shiki-light:#6F42C1"> NextRequest</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) {</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> session</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> await</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> auth</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">()</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  if</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> (session?.error </span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">===</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62"> &#x27;RefreshToken expired&#x27;</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">) {</span></span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">    // 로그아웃 처리</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    await</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> signOut</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">()</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">    // 현재 URL을 state로 저장하여 로그인 후 리다이렉트할 수 있도록 함</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    const</span><span style="--shiki-dark:#6CB6FF;--shiki-light:#005CC5"> callbackUrl</span><span style="--shiki-dark:#F47067;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> encodeURIComponent</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(request.url)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#768390;--shiki-light:#6A737D">    // 로그인 페이지로 리다이렉트</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">    return</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> NextResponse.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">redirect</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span></span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">      new</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1"> URL</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">(</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">`/signin?callbackUrl=${</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">callbackUrl</span><span style="--shiki-dark:#96D0FF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">, request.url)</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">    )</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F47067;--shiki-light:#D73A49">  return</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E"> NextResponse.</span><span style="--shiki-dark:#DCBDFB;--shiki-light:#6F42C1">next</span><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">()</span></span>
<span data-line=""><span style="--shiki-dark:#ADBAC7;--shiki-light:#24292E">}</span></span></code></pre></figure>
<h2 id="배운-점">배운 점</h2>
<ol>
<li><strong>Edge Runtime 고려사항</strong><br/>
<!-- -->Next.js의 미들웨어를 작성할 때는 Edge Runtime의 제약사항을 반드시 고려해야 합니다.</li>
<li><strong>공식 문서의 중요성</strong><br/>
<!-- -->NextAuth.js 공식 문서의 Edge Compatibility 섹션에서 이미 해당 내용을 다루고 있었습니다. 새로운 기능을 구현하기 전에 공식 문서를 꼼꼼히 확인하는 것이 중요합니다.</li>
<li><strong>설계 결정의 trade-off</strong><br/>
<!-- -->bcryptjs로의 교체와 설정 분리 중 성능과 구현 복잡도를 고려하여 최적의 방안을 선택해야 했습니다.</li>
</ol>
<h2 id="참고-자료">참고 자료</h2>
<ul>
<li><a href="https://github.com/kelektiv/node.bcrypt.js/issues/1017">bcrypt GitHub Issue #1017</a></li>
<li><a href="https://authjs.dev/getting-started/migrating-to-v5#edge-compatibility">NextAuth.js 15 Migration Guide - Edge Compatibility</a></li>
</ul></div><hr class="Divider_divider__iotiM"/><div></div></article></main><script src="/_next/static/chunks/webpack-8e3b6a1075085843.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/354532eb11cf5fad.css\",\"style\"]\n2:HL[\"/_next/static/css/fd630683d467c7dc.css\",\"style\"]\n3:HL[\"/_next/static/css/9b708f2b186acac9.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"4:I[2846,[],\"\"]\n7:I[4707,[],\"\"]\na:I[6423,[],\"\"]\nb:I[8087,[\"972\",\"static/chunks/972-1dbf1ef7026efe61.js\",\"185\",\"static/chunks/app/layout-fc049b8ba3ff4c4c.js\"],\"GoogleTagManager\"]\nc:I[7955,[\"972\",\"static/chunks/972-1dbf1ef7026efe61.js\",\"185\",\"static/chunks/app/layout-fc049b8ba3ff4c4c.js\"],\"default\"]\nd:I[4888,[\"972\",\"static/chunks/972-1dbf1ef7026efe61.js\",\"185\",\"static/chunks/app/layout-fc049b8ba3ff4c4c.js\"],\"GoogleAnalytics\"]\nf:I[1060,[],\"\"]\n8:[\"category\",\"frontend\",\"d\"]\n9:[\"slug\",\"20241113_nextauth\",\"d\"]\n10:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L4\",null,{\"buildId\":\"fL74k-rNd5x-lLvSHMVMH\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"posts\",\"frontend\",\"20241113_nextauth\"],\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"category\",\"frontend\",\"d\"],{\"children\":[[\"slug\",\"20241113_nextauth\",\"d\"],{\"children\":[\"__PAGE__?{\\\"category\\\":\\\"frontend\\\",\\\"slug\\\":\\\"20241113_nextauth\\\"}\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"category\",\"frontend\",\"d\"],{\"children\":[[\"slug\",\"20241113_nextauth\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L5\",\"$L6\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/fd630683d467c7dc.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9b708f2b186acac9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$8\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$8\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/354532eb11cf5fad.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"as\":\"style\",\"crossOrigin\":\"anonymous\",\"href\":\"https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css\"}],[\"$\",\"$Lb\",null,{\"gtmId\":\"GTM-TPP4K84Z\"}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"$Lc\",null,{}],[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}],[\"$\",\"$Ld\",null,{\"gaId\":\"G-KJHY5R4DCG\"}]]}]]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]\n"])</script><script>self.__next_f.push([1,"11:I[3706,[\"210\",\"static/chunks/app/posts/%5Bcategory%5D/%5Bslug%5D/page-666dcf2419a8ec86.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"6:[\"$\",\"main\",null,{\"children\":[\"$\",\"article\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"PostDetail_post-detail__header__zshZb\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Next.js 15 Edge Runtime에서 NextAuth v5와 bcrypt 호환성 문제 해결하기\"}],[\"$\",\"time\",null,{\"className\":\"PostDetail_post-detail__date__9juxR\",\"dateTime\":\"2024-11-13\",\"children\":\"13 Nov 2024\"}]]}],[\"$\",\"div\",null,{\"className\":\"markdown\",\"children\":[[\"$\",\"h2\",null,{\"id\":\"들어가며\",\"children\":\"들어가며\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"현재 개발 중인 프로젝트에서 NextAuth.js v5를 사용하여 인증을 구현하고 있습니다.\",[\"$\",\"br\",null,{}],\"\\n\",\"액세스 토큰과 리프레시 토큰을 활용한 인증 시스템에서 비밀번호 해시화를 위해 bcrypt를 사용하던 중 예상치 못한 문제가 발생했습니다.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"문제-상황\",\"children\":\"문제 상황\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"미들웨어를 통해 리프레시 토큰 만료 시 자동 로그아웃 처리를 구현하던 중, 다음과 같은 에러가 발생했습니다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-line-numbers\":\"\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"data-line-numbers-max-digits\":\"2\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// src/lib/auth.ts\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" NextAuth \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'next-auth'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" Credentials \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'next-auth/providers/credentials'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"handlers\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"signIn\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"signOut\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"auth\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" NextAuth\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"({\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  providers: [\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"    Credentials\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"({\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      credentials: {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"        email: {},\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"        password: {},\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"      authorize\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"credentials\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"        // 사용자 정보를 DB로부터 가져오는 함수\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"        const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" getUserFromDb\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(credentials.email, password)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"        if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"user) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"          throw\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" Error\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"'Invalid credentials.'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"        }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"        return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" user\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    }),\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  ],\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"})\"}]}]]}]}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-line-numbers\":\"\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"data-line-numbers-max-digits\":\"2\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// src/middleware.ts\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { NextResponse } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'next/server'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" type\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { NextRequest } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'next/server'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { auth, signOut } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" '@/lib/auth'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" middleware\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"request\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" NextRequest\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" session\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" auth\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (session?.error \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"===\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'RefreshToken expired'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"    // 로그아웃 처리\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    await\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" signOut\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"    // 현재 URL을 state로 저장하여 로그인 후 리다이렉트할 수 있도록 함\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" callbackUrl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" encodeURIComponent\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(request.url)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"    // 로그인 페이지로 리다이렉트\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" NextResponse.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"redirect\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"      new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"`/signin?callbackUrl=${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"callbackUrl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", request.url)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    )\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" NextResponse.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"next\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/posts/20241113_nextauth.png\",\"alt\":\"Edge Runtime 에러 화면\"}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"원인-분석\",\"children\":\"원인 분석\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"edge-runtime의-제약사항\",\"children\":\"Edge Runtime의 제약사항\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Next.js의 미들웨어는 Edge Runtime 환경에서 실행되도록 설계되었습니다. Edge Runtime은 더 빠른 응답 시간과 글로벌 배포를 위해 최적화된 환경이지만, Node.js의 네이티브 모듈을 지원하지 않는 제약이 있습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"🔗 \",[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs/app/building-your-application/routing/middleware#runtime\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":\"Next.js middleware - Runtime\"}]]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"bcrypt의-특성\",\"children\":\"bcrypt의 특성\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"bcrypt는 C++로 작성된 네이티브 모듈입니다. node-pre-gyp 패키지를 통해 Node.js 환경에서 실행되는 네이티브 C++ 확장 모듈을 사전 빌드하여 배포하는데, 이는 Edge Runtime에서 실행될 수 없습니다.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"해결방안\",\"children\":\"해결방안\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"bcryptjs로 교체\\nbcryptjs는 순수 JavaScript로 작성되어 있어 클라이언트 사이드에서도 실행이 가능합니다. 하지만 bcrypt에 비해 약 30% 정도 성능이 떨어진다는 단점이 있습니다.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"🔗 \",[\"$\",\"a\",null,{\"href\":\"https://github.com/dcodeIO/bcrypt.js?tab=readme-ov-file#security-considerations\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":\"bcrypt.js github - Security considerations\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"설정 분리 (선택한 방안)\\nbcrypt를 포함하는 설정을 별도로 분리하여 Edge Runtime에서 실행되지 않도록 처리하는 방법을 선택했습니다.\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"br\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"다음은 구체적인 구현 방법입니다.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-line-numbers\":\"\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"data-line-numbers-max-digits\":\"1\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// src/lib/auth.config.ts\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// bcrpyt를 제외한 config를 분리한다.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" authConfig\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"  //...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  providers: [],\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-line-numbers\":\"\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"data-line-numbers-max-digits\":\"2\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// src/lib/auth.ts\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// bcrpyt를 제외한 config를 import한다.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { authConfig } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" '@/lib/auth/auth.config'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"handlers\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"signIn\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"signOut\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"auth\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" NextAuth\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"({\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  ...\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"authConfig, \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// 추가\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  providers: [\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"    Credentials\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"({\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      credentials: {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"        email: {},\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"        password: {},\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"      authorize\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"async\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"credentials\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"        // 사용자 정보를 DB로부터 가져오는 로직\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"        const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" getUserFromDb\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(credentials.email, password)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"        if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"user) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"          throw\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" Error\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"'Invalid credentials.'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"        }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"        return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" user\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"      },\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    }),\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  ],\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"})\"}]}]]}]}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"tabIndex\":\"0\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"children\":[\"$\",\"code\",null,{\"data-line-numbers\":\"\",\"data-language\":\"tsx\",\"data-theme\":\"github-dark-dimmed github-light\",\"style\":{\"display\":\"grid\"},\"data-line-numbers-max-digits\":\"2\",\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// middleware.ts\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" NextAuth \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'next-auth'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// bcrpyt를 제외한 config를 import한다.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"import\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { authConfig } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"from\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" '@/lib/auth/auth.config'\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"auth\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" } \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" NextAuth\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"({ authConfig }) \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// NextAuth에 쇽!\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" middleware\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#E36209\"},\"children\":\"request\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F69D50\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" NextRequest\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" session\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" auth\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" (session?.error \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"===\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\" 'RefreshToken expired'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"    // 로그아웃 처리\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    await\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" signOut\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"    // 현재 URL을 state로 저장하여 로그인 후 리다이렉트할 수 있도록 함\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6CB6FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" callbackUrl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" encodeURIComponent\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(request.url)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#768390\",\"--shiki-light\":\"#6A737D\"},\"children\":\"    // 로그인 페이지로 리다이렉트\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" NextResponse.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"redirect\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"      new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"`/signin?callbackUrl=${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"callbackUrl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#96D0FF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\", request.url)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"    )\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F47067\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\" NextResponse.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#DCBDFB\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"next\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#ADBAC7\",\"--shiki-light\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"배운-점\",\"children\":\"배운 점\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Edge Runtime 고려사항\"}],[\"$\",\"br\",null,{}],\"\\n\",\"Next.js의 미들웨어를 작성할 때는 Edge Runtime의 제약사항을 반드시 고려해야 합니다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"공식 문서의 중요성\"}],[\"$\",\"br\",null,{}],\"\\n\",\"NextAuth.js 공식 문서의 Edge Compatibility 섹션에서 이미 해당 내용을 다루고 있었습니다. 새로운 기능을 구현하기 전에 공식 문서를 꼼꼼히 확인하는 것이 중요합니다.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"설계 결정의 trade-off\"}],[\"$\",\"br\",null,{}],\"\\n\",\"bcryptjs로의 교체와 설정 분리 중 성능과 구현 복잡도를 고려하여 최적의 방안을 선택해야 했습니다.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"참고-자료\",\"children\":\"참고 자료\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/kelektiv/node.bcrypt.js/issues/1017\",\"children\":\"bcrypt GitHub Issue #1017\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://authjs.dev/getting-started/migrating-to-v5#edge-compatibility\",\"children\":\"NextAuth.js 15 Migration Guide - Edge Compatibility\"}]}],\"\\n\"]}]]}],[\"$\",\"hr\",null,{\"className\":\"Divider_divider__iotiM\"}],[\"$\",\"$L11\",null,{}]]}]}]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Next.js 15 Edge Runtime에서 NextAuth v5와 bcrypt 호환성 문제 해결하기\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Next.js 14에서 NextAuth v5를 사용하면서 마주친 Edge Runtime과 bcrypt 호환성 이슈를 해결하는 과정을 다룹니다. Node.js 네이티브 모듈의 Edge Runtime 제약사항과 이를 해결하기 위한 설정 분리 방법을 상세히 설명합니다.\"}]]\n5:null\n"])</script></body></html>